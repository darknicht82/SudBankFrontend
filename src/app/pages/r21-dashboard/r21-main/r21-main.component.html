<div class="r21-main-container">
  <!-- CABECERA -->
  <div class="header">
    <h1>R21 - Consumos de Tarjetas de Cr茅dito</h1>
    <p class="subtitle">Se deber谩 reportar informaci贸n detallada sobre los consumos realizados con tarjetas de cr茅dito, incluyendo montos, vencimientos, intereses y situaci贸n de las operaciones.</p>
  </div>

  <!-- INFORMACIN DE ESTRUCTURA -->
  <div class="structure-info">
    <div class="card">
      <div class="card-header">
        <h3> Informaci贸n de la Estructura R21</h3>
      </div>
      <div class="card-content">
        <p><strong>Descripci贸n:</strong> Esta estructura contiene informaci贸n detallada sobre los consumos realizados con tarjetas de cr茅dito, incluyendo montos por vencer y vencidos, intereses generados, situaci贸n de las operaciones y otros datos relevantes para el seguimiento y control de la cartera de tarjetas de cr茅dito.</p>
        <p><strong>Periodicidad:</strong> Mensual </p>
        <p><strong>Plazo entrega:</strong> 8 d铆as h谩biles desde la fecha de corte</p>
        <p><strong>C贸digo Banco:</strong> 1038</p>
        <p><strong>Formato archivo:</strong> R21Exxxxddmmaaaa.txt</p>
        <p><strong>Fuente:</strong> Manual Estructuras R2023 - SB Septiembre 2023</p>
        
        <div class="requirements">
          <strong>Requisitos:</strong>
          <ul>
            <li>Estructura mensual obligatoria</li>
            <li>47 campos oficiales (7 obligatorios, 40 opcionales)</li>
            <li>Formato TXT con separador tabulador</li>
            <li>Validaciones seg煤n manual SB</li>
          </ul>
        </div>

        <strong>Campos Oficiales:</strong>
          <div style="height: 400px;width: 100%;overflow: auto;border: 1px solid #ccc;background: #fff;">
            <app-r21-fields-table></app-r21-fields-table>
          </div>  
      </div>
    </div>
  </div>

  <!-- RESUMEN -->
  <div class="summary-section">
    <div class="card">
      <div class="card-header">
        <h3> Resumen del Reporte</h3>
      </div>
      <div class="card-content">
        <div class="summary-grid">
          <div class="summary-item">
            <label>Total Registros:</label>
            <span>{{ arrayResume.length }}</span>
          </div>
          <div class="summary-item">
            <label>Fecha Generaci贸n:</label>
            <span> 2025/01/10 </span>
          </div>
          <div class="summary-item">
            <label>Tarjetas Activas:</label>
            <span>{{ arrayResume.length }}</span>
          </div>
          <div class="summary-item">
            <label>Capital Total:</label>
            <span>{{ getTotalCapital() }}</span>
          </div>
          <div class="summary-item">
            <label>Cupo Total:</label>
            <span>{{ getTotalCupo() }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="data-section">
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>
              Tipo de Identificaci贸n
            </th>
            <th>
              Identificaci贸n del Sujeto
            </th>
            <th>
              N煤mero de Tarjeta
            </th>
            <th>
              Cupo de Tarjeta
            </th>
            <th>
              Capital de Consumo
            </th>
            <th>
              TEA
            </th>
            <th>
              Estado de Operaci贸n
            </th>
            <th>
              Forma de Pago
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of arrayResume">
            <td class="data-cell">
              <span class="cell-value">{{ item.tipoIdentificacion?.descripcion || 'N/A' }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.identificacionSujeto || 'N/A' }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.numeroTarjeta || 'N/A' }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.cupoTarjeta }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.capitalConsumo }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.tea }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.estadoOperacion?.descripcion || 'N/A' }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.formaPago?.descripcion || 'N/A' }}</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="d-flex gap-2">
    <button (click)="validateAndGenerateReport()" [disabled]="loading" class="btn btn-primary">
      <i class="pi pi-check-circle"></i>
      {{ loading ? 'Validando...' : 'Validar y Generar Reporte R21' }}
    </button>

    <button (click)="exportToTxt()" class="btn btn-success">
      <i class="pi pi-download"></i>
      Exportar TXT
    </button>

    <button (click)="openModal()" class="btn btn-info">
      <i class="pi pi-plus"></i>
      Crear Nuevo Registro
    </button>
  </div>



  <app-r21-modal-form
    [isVisible]="showModalForm"
    (modalClosed)="onModalClosed()"></app-r21-modal-form>

  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Generando reporte R21...</p>
    </div>
  </div>
</div>
