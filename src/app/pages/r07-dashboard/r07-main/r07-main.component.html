<div class="r07-main-container">
  <!-- CABECERA -->
  <div class="header">
    <h1>R07 - Garant칤as Reales</h1>
    <p class="subtitle">Se deber치 reportar 칰nicamente las garant칤as reales que se hayan constituido cada mes. Cada garant칤a debe reportarse una 칰nica vez en esta estructura, hasta que se la cancele o liquide.</p>
  </div>

  <!-- INFORMACI칍N DE ESTRUCTURA -->
  <div class="structure-info">
    <div class="card">
      <div class="card-header">
        <h3>游늶 Informaci칩n de la Estructura R07</h3>
      </div>
      <div class="card-content">
        <p><strong>Descripci칩n:</strong> Si una garant칤a que sali칩 del portafolio de la entidad es constituida o reingresada nuevamente en otro mes, debe volverse a reportar con la nueva fecha de constituci칩n. Si una garant칤a es constituida y cancelada dentro de un mismo mes y a la fecha de corte de la estructura la misma ya no se encuentra en el portafolio de la entidad, dicha garant칤a s칤 debe reportarse en esta estructura, as칤 como tambi칠n debe ser reportada en la estructura R08 como liquidaci칩n total.</p>
        <p><strong>Periodicidad:</strong> Mensual </p>
        <p><strong>Plazo entrega:</strong> Seg칰n requerimientos de la SB</p>
        <p><strong>C칩digo Banco:</strong> 1038</p>
        <p><strong>Formato archivo:</strong> r07Exxxxddmmaaaa.txt</p>
        <p><strong>Fuente:</strong> Manual de Operaciones Activas y Contingentes - SB Septiembre 2023</p>
        
        <div class="requirements">
          <strong>Requisitos:</strong>
          <ul>
            <li>Estructura eventual (no mensual)</li>
            <li>15 campos oficiales obligatorios</li>
            <li>Formato TXT con separador tabulador</li>
            <li>Validaciones seg칰n manual SB</li>
          </ul>
        </div>

        <strong>Campos Oficiales:</strong>
          <div style="height: 400px;width: 100%;overflow: auto;border: 1px solid #ccc;background: #fff;">
            <!-- Tabla de campos R07 -->
            <table class="fields-table">
              <thead>
                <tr>
                  <th>Campo</th>
                  <th>Descripci칩n</th>
                  <th>Tipo</th>
                  <th>Obligatorio</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>tipoIdentificacionSujeto</td><td>Tipo de Identificaci칩n del Sujeto</td><td>String</td><td>S칤</td></tr>
                <tr><td>identificacionSujeto</td><td>Identificaci칩n del Sujeto</td><td>String</td><td>S칤</td></tr>
                <tr><td>numeroOperacion</td><td>N칰mero de Operaci칩n</td><td>String</td><td>S칤</td></tr>
                <tr><td>numeroGarantia</td><td>N칰mero de Garant칤a</td><td>String</td><td>S칤</td></tr>
                <tr><td>tipoGarantia</td><td>Tipo de Garant칤a</td><td>String</td><td>S칤</td></tr>
                <tr><td>descripcionGarantia</td><td>Descripci칩n de Garant칤a</td><td>String</td><td>S칤</td></tr>
                <tr><td>ubicacionGarantiaPais</td><td>Ubicaci칩n Garant칤a Pa칤s</td><td>String</td><td>S칤</td></tr>
                <tr><td>ubicacionGarantiaProvincia</td><td>Ubicaci칩n Garant칤a Provincia</td><td>String</td><td>No</td></tr>
                <tr><td>ubicacionGarantiaCanton</td><td>Ubicaci칩n Garant칤a Cant칩n</td><td>String</td><td>No</td></tr>
                <tr><td>valorAvaluoTitulo</td><td>Valor Aval칰o T칤tulo</td><td>Number</td><td>S칤</td></tr>
                <tr><td>fechaAvaluo</td><td>Fecha Aval칰o</td><td>String</td><td>S칤</td></tr>
                <tr><td>numeroRegistroGarantia</td><td>N칰mero Registro Garant칤a</td><td>String</td><td>No</td></tr>
                <tr><td>fechaContabilizacionGarantia</td><td>Fecha Contabilizaci칩n Garant칤a</td><td>String</td><td>S칤</td></tr>
                <tr><td>porcentajeCubreGarantia</td><td>Porcentaje Cubre Garant칤a</td><td>Number</td><td>S칤</td></tr>
                <tr><td>estadoRegistro</td><td>Estado Registro</td><td>String</td><td>S칤</td></tr>
              </tbody>
            </table>
          </div>  
      </div>
    </div>
  </div>

  <!-- RESUMEN -->
  <div class="summary-section">
    <div class="card">
      <div class="card-header">
        <h3>游늵 Resumen del Reporte</h3>
      </div>
      <div class="card-content">
        <div class="summary-grid">
          <div class="summary-item">
            <label>Total Registros:</label>
            <span>{{ arrayResume.length }}</span>
          </div>
          <div class="summary-item">
            <label>Fecha Generaci칩n:</label>
            <span> 2025/01/20 </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="data-section">
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>
              Tipo de Identificaci칩n
            </th>
            <th>
              Identificaci칩n Sujeto
            </th>
            <th>
              N칰mero de Operaci칩n
            </th>
            <th>
              N칰mero de Garant칤a
            </th>
            <th>
              Tipo de Garant칤a
            </th>
            <th>
              Descripci칩n de Garant칤a
            </th>
            <th>
              Ubicaci칩n Pa칤s
            </th>
            <th>
              Ubicaci칩n Provincia
            </th>
            <th>
              Ubicaci칩n Cant칩n
            </th>
            <th>
              Valor Aval칰o
            </th>
            <th>
              Fecha Aval칰o
            </th>
            <th>
              N칰mero Registro
            </th>
            <th>
              Fecha Contabilizaci칩n
            </th>
            <th>
              % Cubre Garant칤a
            </th>
            <th>
              Estado Registro
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of arrayResume">
            <td class="data-cell">
              <span class="cell-value">{{ item.tipoIdentificacionSujeto?.descripcion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.identificacionSujeto }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.numeroOperacion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.numeroGarantia }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.tipoGarantia?.descripcion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.descripcionGarantia }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.ubicacionGarantiaPais?.descripcion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.ubicacionGarantiaProvincia?.descripcion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.ubicacionGarantiaCanton?.descripcion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">${{ item.valorAvaluoTitulo?.toLocaleString() }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.fechaAvaluo }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.numeroRegistroGarantia }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.fechaContabilizacionGarantia }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.porcentajeCubreGarantia }}%</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.estadoRegistro?.descripcion }}</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="d-flex gap-2">
    <button (click)="validateAndGenerateReport()" [disabled]="loading" class="btn btn-primary">
      <i class="pi pi-check-circle"></i>
      {{ loading ? 'Validando...' : 'Validar y Generar Reporte R07' }}
    </button>

    <button (click)="exportToTxt()" class="btn btn-success">
      <i class="pi pi-download"></i>
      Exportar TXT
    </button>

    <button (click)="openModal()" class="btn btn-info">
      <i class="pi pi-plus"></i>
      Crear Nuevo Registro
    </button>
  </div>



  <app-r07-modal-form
    [isVisible]="showModalForm"
    (modalClosed)="onModalClosed()"></app-r07-modal-form>

  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Generando reporte R07...</p>
    </div>
  </div>
</div>