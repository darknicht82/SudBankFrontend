<div class="r05-main-container">
  <!-- CABECERA -->
  <div class="header">
    <h1>R05 - Reportes de Cancelaciones</h1>
    <p class="subtitle">Se deber谩 reportar 煤nicamente los nuevos t铆tulos que se hayan instrumentado cada mes. Cada t铆tulo debe reportarse una 煤nica vez en esta estructura, hasta que se lo venda o liquide.</p>
  </div>

   <!-- INFORMACIN DE ESTRUCTURA -->
  <div class="structure-info">
    <div class="card">
      <div class="card-header">
        <h3> Informaci贸n de la Estructura R05</h3>
      </div>
      <div class="card-content">
        <p><strong>Descripci贸n:</strong> Esta estructura tiene periodicidad eventual y comprende el detalle de las operaciones de cr茅dito y contingentes que han sido canceladas o cedidas, as铆 como tambi茅n la cancelaci贸n definitiva de las tarjetas de cr茅dito. Adicionalmente comprende informaci贸n de cambios de calificaciones de las operaciones que a煤n se encuentran activas (de manera excepcional, cuando se requiere reportar el cambio de calificaci贸n antes el proceso mensual).</p>
        <p><strong>Periodicidad:</strong> Mensual </p>
        <p><strong>Plazo entrega:</strong> Seg煤n requerimientos de la SB</p>
        <p><strong>C贸digo Banco:</strong> 1038</p>
        <p><strong>Formato archivo:</strong> R05Exxxxddmmaaaa.txt</p>
        <p><strong>Fuente:</strong> Manual de Control de Inversiones - SB Marzo 2017</p>
        
        <div class="requirements">
          <strong>Requisitos:</strong>
          <ul>
            <li>Estructura eventual (no mensual)</li>
            <li>5 campos oficiales obligatorios</li>
            <li>Formato TXT con separador tabulador</li>
            <li>Validaciones seg煤n manual SB</li>
          </ul>
        </div>

        <strong>Campos Oficiales:</strong>
          <div style="height: 400px;width: 100%;overflow: auto;border: 1px solid #ccc;background: #fff;">
            <app-r05-fields-table></app-r05-fields-table>
          </div>  
      </div>
    </div>
  </div>

  <!-- RESUMEN -->
  <div class="summary-section">
    <div class="card">
      <div class="card-header">
        <h3> Resumen del Reporte</h3>
      </div>
      <div class="card-content">
        <div class="summary-grid">
          <div class="summary-item">
            <label>Total Registros:</label>
            <span>{{ 20 }}</span>
          </div>
          <div class="summary-item">
            <label>Fecha Generaci贸n:</label>
            <span> 2025/08/20 </span>
          </div>
          <div class="summary-item">
            <label>Emisores:</label>
            <span>{{ 20 }}</span>
          </div>
          <div class="summary-item">
            <label>Custodios:</label>
            <span>{{ 20 }}</span>
          </div>
          <div class="summary-item">
            <label>Depositarios:</label>
            <span>{{ 20 }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

   <div class="data-section">
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>
              Tipo de Identificaci贸n
            </th>
            <th>
              Identificaci贸n
            </th>
            <th>
              N煤mero de Operaci贸n
            </th>
            <th>
              Tipo de transaccion
            </th>
            <th>
              Fecha de cancelaci贸n
            </th>
            <th>
              Forma de cancelaci贸n
            </th>
            <th>
              Calificaci贸n
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of arrayResume">
            <td class="data-cell">
              <span class="cell-value">{{ item.tipoIdentificacion?.descripcion  }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.identificacionSujeto }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.numeroOperacion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.codigoTipoTransaccion?.descripcion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.fechaCancelacion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.codigoFormaCancelacion?.descripcion }}</span>
            </td>
            <td class="data-cell">
              <span class="cell-value">{{ item.codigoCalificacion?.descripcion }}</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="d-flex gap-2">
    <button (click)="validateAndGenerateReport()" [disabled]="loading" class="btn btn-primary">
      <i class="pi pi-check-circle"></i>
      {{ loading ? 'Validando...' : 'Validar y Generar Reporte R05' }}
    </button>

    <button (click)="exportToTxt()" class="btn btn-success">
      <i class="pi pi-download"></i>
      Exportar TXT
    </button>

    <button (click)="openModal()" class="btn btn-info">
      <i class="pi pi-plus"></i>
      Crear Nuevo Registro
    </button>
  </div>

  <app-r05-modal-form
    [isVisible]="showModalForm"
    (modalClosed)="onModalClosed()"></app-r05-modal-form>

  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Generando reporte R05...</p>
    </div>
  </div>

</div>  
