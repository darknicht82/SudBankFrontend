<!-- Modal de Resultados de Validaci√≥n L01 -->
<div class="validation-modal-overlay"
     *ngIf="showModal"
     (click)="onClose()">

  <div class="validation-modal"
       (click)="$event.stopPropagation()">

    <!-- Header del Modal -->
    <div class="modal-header">
      <div class="header-content">
        <span class="operation-icon">üîç</span>
        <h3 class="modal-title">Resultados de Validaci√≥n L01</h3>
      </div>
      <button class="close-button" (click)="onClose()" type="button">
        <span>&times;</span>
      </button>
    </div>

    <!-- Contenido del Modal -->
    <div class="modal-body">

      <!-- Estado General de Validaci√≥n -->
      <div class="validation-status">
        <div class="status-header">
          <h4>üìä Estado General de Validaci√≥n:</h4>
          <div class="status-badge" [ngClass]="getEstadoClass(validationResults?.estadoGeneral || '')">
            {{ validationResults?.estadoGeneral || 'PENDIENTE' }}
          </div>
        </div>
        <p class="status-description">
          {{ getEstadoDescription(validationResults?.estadoGeneral || '') }}
        </p>
      </div>

      <!-- Informaci√≥n del Proceso -->
      <div class="process-info">
        <h4>üìã Informaci√≥n del Proceso:</h4>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Total Registros:</span>
            <span class="info-value">{{ validationResults?.totalRegistros || 0 }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Fecha de Validaci√≥n:</span>
            <span class="info-value">{{ formatDateSafely(validationResults?.timestamp) }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Usuario:</span>
            <span class="info-value">Christian Aguirre</span>
          </div>
        </div>
      </div>

      <!-- Filtros Aplicados -->
      <div class="filters-applied" *ngIf="validationResults?.filtrosAplicados">
        <h4>üîç Filtros Aplicados:</h4>
        <div class="filters-grid">
          <div class="filter-item">
            <span class="filter-label">Tipo Identificaci√≥n:</span>
            <span class="filter-value">{{ getFilterDescription('tipoIdentificacion', validationResults?.filtrosAplicados?.tipoIdentificacion || '') }}</span>
          </div>
          <div class="filter-item">
            <span class="filter-label">Clasificaci√≥n:</span>
            <span class="filter-value">{{ getFilterDescription('clasificacion', validationResults?.filtrosAplicados?.clasificacion || '') }}</span>
          </div>
          <div class="filter-item">
            <span class="filter-label">Tipo Emisor:</span>
            <span class="filter-value">{{ getFilterDescription('tipoEmisor', validationResults?.filtrosAplicados?.tipoEmisor || '') }}</span>
          </div>
        </div>
      </div>

      <!-- Resumen por Estado de Validaci√≥n -->
      <div class="validation-summary" *ngIf="validationResults?.registrosValidados && (validationResults?.registrosValidados?.length || 0) > 0">
        <h4>üìä Resumen por Estado de Validaci√≥n:</h4>
        <div class="summary-grid">
          <div class="summary-item estado-valido">
            <span class="summary-label">V√°lidos:</span>
            <span class="summary-value">{{ getCountByEstado(VALIDATION_STATES.VALIDO) }}</span>
          </div>
          <div class="summary-item estado-advertencia">
            <span class="summary-label">Con Advertencias:</span>
            <span class="summary-value">{{ getCountByEstado(VALIDATION_STATES.VALIDO_CON_ADVERTENCIAS) }}</span>
          </div>
          <div class="summary-item estado-error">
            <span class="summary-label">Con Errores:</span>
            <span class="summary-value">{{ getCountByEstado(VALIDATION_STATES.CON_ERRORES) }}</span>
          </div>
          <div class="summary-item estado-pendiente">
            <span class="summary-label">Pendientes:</span>
            <span class="summary-value">{{ getCountByEstado(VALIDATION_STATES.PENDIENTE) }}</span>
          </div>
        </div>
      </div>

      <!-- Detalle de Errores -->
      <div class="errors-detail" *ngIf="validationResults?.erroresEncontrados && (validationResults?.erroresEncontrados?.length || 0) > 0">
        <h4>‚ùå Errores Cr√≠ticos Encontrados:</h4>
        <div class="errors-list">
          <div class="error-item" *ngFor="let error of validationResults!.erroresEncontrados!; trackBy: trackByError">
            <div class="error-header">
              <span class="error-field">{{ error.campo }}</span>
              <span class="error-severity">{{ error.severidad }}</span>
            </div>
            <p class="error-message">{{ error.mensaje }}</p>
          </div>
        </div>
      </div>

      <!-- Detalle de Advertencias -->
      <div class="warnings-detail" *ngIf="validationResults?.advertencias && (validationResults?.advertencias?.length || 0) > 0">
        <h4>‚ö†Ô∏è Advertencias Encontradas:</h4>
        <div class="warnings-list">
          <div class="warning-item" *ngFor="let warning of validationResults!.advertencias!; trackBy: trackByError">
            <div class="warning-header">
              <span class="warning-field">{{ warning.campo }}</span>
              <span class="warning-severity">{{ warning.severidad }}</span>
            </div>
            <p class="error-message">{{ warning.mensaje }}</p>
          </div>
        </div>
      </div>

      <!-- Mensaje cuando no hay datos -->
      <div class="no-data-message" *ngIf="!validationResults?.registrosValidados || (validationResults?.registrosValidados?.length || 0) === 0">
        <div class="no-data-icon">üì≠</div>
        <p>No se encontraron registros para validar con los filtros aplicados.</p>
        <p class="suggestion">Sugerencia: Intente con filtros diferentes o cree nuevos registros.</p>
      </div>

    </div>

    <!-- Footer del Modal con Botones -->
    <div class="modal-footer">
      <div class="footer-actions">
        <!-- Bot√≥n Proceder con Reporte (solo si no hay errores cr√≠ticos) -->
        <button
          (click)="onProceedWithReport()"
          [disabled]="!canProceedWithReport()"
          class="btn btn-success">
          <i class="pi pi-check"></i>
          Proceder con Reporte
        </button>

        <!-- Bot√≥n Corregir Errores (solo si hay errores) -->
        <button
          (click)="onFixErrors()"
          *ngIf="validationResults?.estadoGeneral === VALIDATION_STATES.CON_ERRORES"
          class="btn btn-warning">
          <i class="pi pi-exclamation-triangle"></i>
          Corregir Errores
        </button>

        <!-- Bot√≥n Cerrar -->
        <button
          (click)="onClose()"
          class="btn btn-secondary">
          <i class="pi pi-times"></i>
          Cerrar
        </button>
      </div>
    </div>

  </div>
</div>
