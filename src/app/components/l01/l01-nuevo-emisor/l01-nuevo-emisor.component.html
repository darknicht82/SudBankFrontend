<p-dialog 
  header="Agregar Nuevo Emisor/Custodio" 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="false"
  [dismissableMask]="false"
  [style]="{width: '600px'}" 
  (onHide)="closeModal()"
  class="theme-l01">

  <div *ngIf="loading" class="loading-message-sudbank">
    <i class="pi pi-spinner pi-spin"></i> Cargando pa√≠ses...
  </div>

  <div *ngIf="error" class="error-message-sudbank">
    <i class="pi pi-exclamation-triangle"></i> {{ error }}
  </div>

  <form [formGroup]="form" *ngIf="!loading" class="space-y-md">
    <div class="field">
      <label class="label-sudbank required">Pa√≠s *</label>
      <p-select 
        formControlName="codigoPais" 
        [options]="paises" 
        optionLabel="descripcion" 
        optionValue="id" 
        placeholder="Seleccione el pa√≠s" 
        (onChange)="onPaisChange($event)"
        [showClear]="true"
        [filter]="true"
        filterPlaceholder="Buscar pa√≠s...">
      </p-select>
      <small class="error-message-sudbank" *ngIf="form.get('codigoPais')?.errors?.['required']">El pa√≠s es obligatorio</small>
    </div>

    <div class="field">
      <label class="label-sudbank required">C√≥digo/Identificaci√≥n *</label>
      <input pInputText formControlName="codigo" [placeholder]="getPlaceholder()" [maxlength]="getMaxLength()" class="input-sudbank">
      <small class="error-message-sudbank" *ngIf="form.get('codigo')?.errors?.['required']">El c√≥digo es obligatorio</small>
      <small class="error-message-sudbank" *ngIf="form.get('codigo')?.errors?.['rucLongitud']">El RUC debe tener exactamente 13 d√≠gitos</small>
      <small class="error-message-sudbank" *ngIf="form.get('codigo')?.errors?.['rucPrefijo']">Prefijo RUC inv√°lido. Debe ser: 00, 10, 15, 17, 20, 21, 25 o 30</small>
      <small class="error-message-sudbank" *ngIf="form.get('codigo')?.errors?.['rucVerificador']">D√≠gito verificador del RUC inv√°lido</small>
      <small class="error-message-sudbank" *ngIf="form.get('codigo')?.errors?.['pattern']">Formato general inv√°lido</small>
    </div>

    <div class="field">
      <label class="label-sudbank required">Descripci√≥n *</label>
      <input pInputText formControlName="descripcion" placeholder="Nombre de la entidad" maxlength="255" class="input-sudbank">
      <small class="error-message-sudbank" *ngIf="form.get('descripcion')?.errors?.['required']">La descripci√≥n es obligatoria</small>
    </div>

    <div class="info-message-sudbank" *ngIf="form.get('codigoPais')?.value">
      <small>
        <strong>üìã Informaci√≥n del Pa√≠s:</strong><br>
        ‚Ä¢ <strong>üåç Pa√≠s:</strong> {{ getPaisDescripcion(form.get('codigoPais')?.value) }}<br>
        ‚Ä¢ <strong>üîí Validaci√≥n:</strong> 
        <span *ngIf="form.get('codigoPais')?.value === 60" class="ecuador-info">
          RUC Ecuador (00 + 9 d√≠gitos CI + 1 d√≠gito verificador)
        </span>
        <span *ngIf="form.get('codigoPais')?.value !== 60" class="extranjero-info">
          C√≥digo extranjero (1-50 caracteres)
        </span><br>
        ‚Ä¢ <strong>üìù Formato esperado:</strong> 
        <span *ngIf="form.get('codigoPais')?.value === 60" class="ruc-format">
          Ejemplo: 0012345678901
        </span>
        <span *ngIf="form.get('codigoPais')?.value !== 60" class="extranjero-format">
          C√≥digo alfanum√©rico √∫nico
        </span>
      </small>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button pButton type="button" label="Cancelar" (click)="closeModal()" class="btn-sudbank btn-sudbank-outline"></button>
    <button pButton type="button" label="Guardar" (click)="saveEmitter()" [disabled]="!form.valid || loading" class="btn-sudbank btn-sudbank-primary"></button>
  </ng-template>
</p-dialog>
