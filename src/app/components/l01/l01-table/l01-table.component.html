<div class="l01-table-container">
  <!-- Header de la tabla -->
  <div class="table-header">
    <div class="header-content">
      <h2>
        <i class="pi pi-table"></i>
        Registros L01 - Emisores, Custodios y Contrapartes
      </h2>
      <p>Gestión de emisores, custodios de inversiones, depositarios de fondos disponibles y contrapartes en operaciones de reporto</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="onRefresh()" [disabled]="isLoading">
        <i class="pi pi-refresh"></i>
        Actualizar
      </button>
      <button class="btn btn-info" (click)="onExport()">
        <i class="pi pi-download"></i>
        Exportar
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-group">
        <label for="tipo">Tipo de Emisor</label>
        <select 
          id="tipo"
          [(ngModel)]="filtros.tipo"
          class="form-control"
          (change)="aplicarFiltros()"
        >
          <option value="">Todos los tipos</option>
          <option *ngFor="let catalog of tabla73Catalogs" [value]="catalog.codigo">
            {{ catalog.codigo }} - {{ catalog.descripcion }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="tipoIdentificacion">Tipo de Identificación</label>
        <select 
          id="tipoIdentificacion"
          [(ngModel)]="filtros.tipoIdentificacion"
          class="form-control"
          (change)="aplicarFiltros()"
        >
          <option value="">Todos los tipos</option>
          <option *ngFor="let catalog of tabla4Catalogs" [value]="catalog.codigo">
            {{ catalog.codigo }} - {{ catalog.descripcion }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="clasificacion">Clasificación</label>
        <select 
          id="clasificacion"
          [(ngModel)]="filtros.clasificacion"
          class="form-control"
          (change)="aplicarFiltros()"
        >
          <option value="">Todas las clasificaciones</option>
          <option *ngFor="let catalog of tabla173Catalogs" [value]="catalog.codigo">
            {{ catalog.codigo }} - {{ catalog.descripcion }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="busqueda">Búsqueda</label>
        <input 
          type="text" 
          id="busqueda"
          [(ngModel)]="filtros.busqueda"
          class="form-control search-input"
          placeholder="Buscar por identificación, clasificación, tipo..."
          (input)="aplicarFiltros()"
        >
      </div>
    </div>

    <div class="filters-actions">
      <button class="btn btn-secondary" (click)="limpiarFiltros()">
        <i class="pi pi-times"></i>
        Limpiar Filtros
      </button>
      <button class="btn btn-primary" (click)="aplicarFiltros()">
        <i class="pi pi-search"></i>
        Aplicar Filtros
      </button>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="stats-section">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-list"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ totalRegistros }}</div>
          <div class="stat-label">Total Registros</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-home"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ registrosNacionales }}</div>
          <div class="stat-label">Nacionales (RUC)</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-globe"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ registrosExtranjeros }}</div>
          <div class="stat-label">Extranjeros</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-check-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ registrosActivos }}</div>
          <div class="stat-label">Registros Activos</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de datos -->
  <div class="table-wrapper">
    <table class="data-table">
      <thead>
        <tr>
          <th (click)="ordenarPor('fechaReporte')" class="sortable">
            <div class="th-content">
              Fecha Reporte
              <i [class]="getSortIcon('fechaReporte')"></i>
            </div>
          </th>
          <th (click)="ordenarPor('tipoIdentificacion')" class="sortable">
            <div class="th-content">
              Tipo ID
              <i [class]="getSortIcon('tipoIdentificacion')"></i>
            </div>
          </th>
          <th (click)="ordenarPor('identificacion')" class="sortable">
            <div class="th-content">
              Identificación
              <i [class]="getSortIcon('identificacion')"></i>
            </div>
          </th>
          <th (click)="ordenarPor('clasificacion')" class="sortable">
            <div class="th-content">
              Clasificación
              <i [class]="getSortIcon('clasificacion')"></i>
            </div>
          </th>
          <th (click)="ordenarPor('tipo')" class="sortable">
            <div class="th-content">
              Tipo
              <i [class]="getSortIcon('tipo')"></i>
            </div>
          </th>
          <th (click)="ordenarPor('estado')" class="sortable">
            <div class="th-content">
              Estado
              <i [class]="getSortIcon('estado')"></i>
            </div>
          </th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of registrosPaginados" class="table-row">
                      <td>{{ item.fechaCreacion ? formatDate(item.fechaCreacion) : '-' }}</td>
          <td>
            <span class="badge" [class]="item.tipoIdentificacion === 'R' ? 'badge-primary' : 'badge-secondary'">
              {{ item.tipoIdentificacion }}
            </span>
            <small class="d-block">{{ getCatalogDescription('t4', item.tipoIdentificacion) }}</small>
          </td>
          <td>
            <div class="identificacion-cell">
              <div class="identificacion-value">{{ item.identificacion }}</div>
              <div class="identificacion-type">
                {{ item.tipoIdentificacion === 'R' ? 'RUC' : 'Código Ext.' }}
              </div>
            </div>
          </td>
          <td>
            <div class="clasificacion-cell">
              <div class="clasificacion-code">{{ item.clasificacion }}</div>
              <div class="clasificacion-desc">{{ getCatalogDescription('t173', item.clasificacion.toString()) }}</div>
            </div>
          </td>
          <td>
            <div class="tipo-cell">
              <div class="tipo-code">{{ item.tipo }}</div>
              <div class="tipo-desc">{{ getCatalogDescription('t73', item.tipo.toString()) }}</div>
            </div>
          </td>
                      <td>
              <span class="status-badge active">
                <i class="pi pi-check-circle"></i>
                Activo
              </span>
            </td>
          <td>
            <div class="actions-cell">
              <button class="action-btn" (click)="verDetalle(item)" title="Ver detalle">
                <i class="pi pi-eye"></i>
              </button>
              <button class="action-btn" (click)="editar(item)" title="Editar">
                <i class="pi pi-pencil"></i>
              </button>
              <button class="action-btn danger" (click)="eliminar(item)" title="Eliminar">
                <i class="pi pi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Estado de carga -->
    <div *ngIf="isLoading" class="loading-overlay">
      <div class="loading-spinner">
        <i class="pi pi-spinner"></i>
        <p>Cargando registros...</p>
      </div>
    </div>

    <!-- Sin datos -->
    <div *ngIf="!isLoading && registrosPaginados.length === 0" class="no-data">
      <i class="pi pi-inbox"></i>
      <p>No se encontraron registros</p>
    </div>
  </div>

  <!-- Paginación -->
  <div class="pagination-container">
    <div class="pagination-info">
      Mostrando {{ inicioPagina + 1 }} - {{ finPagina }} de {{ registrosFiltrados.length }} registros
    </div>

    <div class="pagination-controls">
      <button 
        class="pagination-btn" 
        [disabled]="paginaActual === 1"
        (click)="cambiarPagina(paginaActual - 1)"
      >
        <i class="pi pi-chevron-left"></i>
        Anterior
      </button>

      <div class="pagination-pages">
        <button 
          *ngFor="let pagina of paginasVisibles"
          class="pagination-btn"
          [class.active]="pagina === paginaActual"
          (click)="cambiarPagina(pagina)"
        >
          {{ pagina }}
        </button>
      </div>

      <button 
        class="pagination-btn" 
        [disabled]="paginaActual === totalPaginas"
        (click)="cambiarPagina(paginaActual + 1)"
      >
        Siguiente
        <i class="pi pi-chevron-right"></i>
      </button>
    </div>

    <div class="pagination-size">
      <label for="tamanoPagina">Por página:</label>
      <select 
        id="tamanoPagina"
        [(ngModel)]="tamanoPagina"
        (change)="cambiarTamanoPagina()"
        class="form-control"
      >
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>
  </div>
</div>
