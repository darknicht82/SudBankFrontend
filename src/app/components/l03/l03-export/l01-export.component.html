<!-- Componente de Exportación L01 -->
<div class="l01-export-container">
  <!-- Cabecera -->
  <div class="export-header">
    <h4 class="mb-3">
      <i class="fas fa-file-export me-2"></i>
      Generar Reporte L01 - Estructura Eventual
    </h4>
    <button 
      type="button" 
      class="btn btn-sm btn-outline-secondary"
      (click)="refrescarInfo()"
      [disabled]="isExporting">
      <i class="fas fa-sync-alt"></i>
      Actualizar
    </button>
  </div>

  <!-- Información del archivo -->
  <div class="export-info card mb-4">
    <div class="card-header">
      <h6 class="mb-0">
        <i class="fas fa-info-circle me-2"></i>
        Información del Archivo
      </h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p class="mb-2">
            <strong>Archivo:</strong> 
            <code>{{ archivoInfo.nombre || 'L01E1038ddmmaaaa.txt' }}</code>
          </p>
          <p class="mb-2">
            <strong>Estructura:</strong> {{ archivoInfo.estructura || 'L01' }}
          </p>
          <p class="mb-2">
            <strong>Entidad:</strong> {{ archivoInfo.entidad || '1038' }} - Banco Sudamericano
          </p>
        </div>
        <div class="col-md-6">
          <p class="mb-2">
            <strong>Fecha corte:</strong> {{ fechaCorte | date:'dd/MM/yyyy' }}
          </p>
          <p class="mb-2">
            <strong>Total registros:</strong> {{ archivoInfo.totalRegistros || (data.length + 1) }}
          </p>
          <p class="mb-2">
            <strong>Periodicidad:</strong> Eventual (E)
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado RVC -->
  <div class="rvc-status mb-4">
    <div class="alert alert-info d-flex align-items-center">
      <i class="fas fa-server me-2"></i>
      <div>
        <strong>Sistema RVC:</strong> 
        <span [class]="claseEstadoRVC">{{ estadoRVC }}</span>
        <small class="d-block text-muted">
          https://appweb.superbancos.gob.ec/rvc
        </small>
      </div>
    </div>
  </div>

  <!-- Opciones de exportación -->
  <div class="export-actions mb-4">
    <div class="row">
      <!-- Opción Descarga -->
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body text-center">
            <i class="fas fa-download fa-3x text-primary mb-3"></i>
            <h5 class="card-title">Descargar Archivo</h5>
            <p class="card-text text-muted">
              Descarga directa del archivo TXT en formato oficial SB
            </p>
            <button 
              type="button"
              class="btn btn-primary btn-lg w-100"
              (click)="exportar('descargar')"
              [disabled]="!puedeExportar">
              <span *ngIf="isExporting && lastExportResult?.filename" 
                    class="spinner-border spinner-border-sm me-2"></span>
              <i class="fas fa-download me-2" *ngIf="!isExporting"></i>
              Descargar TXT
            </button>
          </div>
        </div>
      </div>

      <!-- Opción Envío RVC -->
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body text-center">
            <i class="fas fa-paper-plane fa-3x text-success mb-3"></i>
            <h5 class="card-title">Enviar a RVC</h5>
            <p class="card-text text-muted">
              Transmisión directa al sistema oficial de la Superintendencia
            </p>
            <button 
              type="button"
              class="btn btn-success btn-lg w-100"
              (click)="exportar('enviar_rvc')"
              [disabled]="!puedeEnviarRVC">
              <span *ngIf="isExporting && !lastExportResult?.filename" 
                    class="spinner-border spinner-border-sm me-2"></span>
              <i class="fas fa-paper-plane me-2" *ngIf="!isExporting"></i>
              Enviar a RVC
            </button>
            <small class="d-block mt-2 text-muted" *ngIf="!isConnectedToRVC">
              <i class="fas fa-exclamation-triangle me-1"></i>
              Sistema RVC no disponible
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resultado de exportación -->
  <div class="export-result" *ngIf="lastExportResult">
    <div class="alert" 
         [ngClass]="{
           'alert-success': lastExportResult.success === true,
           'alert-danger': lastExportResult.success === false
         }">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h6 class="alert-heading mb-2">
            <i class="fas" 
               [ngClass]="{
                 'fa-check-circle': lastExportResult.success === true,
                 'fa-times-circle': lastExportResult.success === false
               }"></i>
            {{ lastExportResult.success ? 'Exportación Exitosa' : 'Error en Exportación' }}
          </h6>
          <p class="mb-2">{{ lastExportResult.message }}</p>
          
          <!-- Detalles adicionales -->
          <div *ngIf="lastExportResult.success">
            <small class="d-block">
              <strong>Archivo:</strong> {{ lastExportResult.filename }}
            </small>
            <small class="d-block" *ngIf="lastExportResult.transmissionId">
              <strong>ID Transmisión:</strong> {{ lastExportResult.transmissionId }}
            </small>
            <small class="d-block">
              <strong>Fecha:</strong> {{ lastExportResult.timestamp | date:'dd/MM/yyyy HH:mm:ss' }}
            </small>
          </div>
        </div>
        
        <button 
          type="button" 
          class="btn-close" 
          (click)="limpiarResultado()">
        </button>
      </div>
    </div>
  </div>

  <!-- Validaciones -->
  <div class="export-validations" *ngIf="data.length === 0">
    <div class="alert alert-warning">
      <i class="fas fa-exclamation-triangle me-2"></i>
      <strong>Sin datos para exportar</strong>
      <p class="mb-0 mt-2">
        No hay registros de emisores, custodios, depositarios o contrapartes para generar el reporte L01.
      </p>
    </div>
  </div>

  <!-- Información adicional -->
  <div class="export-help mt-4">
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">
          <i class="fas fa-question-circle me-2"></i>
          Información Importante
        </h6>
      </div>
      <div class="card-body">
        <ul class="mb-0">
          <li>La estructura L01 tiene <strong>periodicidad eventual</strong> - solo se envía cuando hay nuevos registros</li>
          <li>El plazo de entrega es de <strong>3 días hábiles</strong> según normativa SB</li>
          <li>El archivo debe cumplir estrictamente el formato <code>L01E1038ddmmaaaa.txt</code></li>
          <li>Todas las transmisiones quedan registradas en bitácoras para auditoría</li>
          <li>Los errores de validación requieren corrección inmediata y retransmisión</li>
        </ul>
      </div>
    </div>
  </div>
</div>