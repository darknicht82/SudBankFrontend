<div class="table-container">
  <!-- Search and Filter Controls -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input 
          type="text" 
          class="form-control" 
          placeholder="Buscar por identificación, operación, garantía o descripción..."
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()"
        >
        <button class="btn btn-outline-secondary" type="button" (click)="onSearch()">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
    <div class="col-md-3">
      <select class="form-select" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()">
        <option value="5">5 por página</option>
        <option value="10">10 por página</option>
        <option value="25">25 por página</option>
        <option value="50">50 por página</option>
      </select>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Table -->
  <div *ngIf="!loading" class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th scope="col" (click)="onSort('identificacionSujeto')" class="sortable">
            Identificación del Sujeto
            <i class="fas fa-sort ms-1"></i>
          </th>
          <th scope="col" (click)="onSort('numeroOperacion')" class="sortable">
            Número de Operación
            <i class="fas fa-sort ms-1"></i>
          </th>
          <th scope="col" (click)="onSort('numeroGarantia')" class="sortable">
            Número de Garantía
            <i class="fas fa-sort ms-1"></i>
          </th>
          <th scope="col">Tipo de Garantía</th>
          <th scope="col" (click)="onSort('descripcionGarantia')" class="sortable">
            Descripción de la Garantía
            <i class="fas fa-sort ms-1"></i>
          </th>
          <th scope="col">Ubicación</th>
          <th scope="col" (click)="onSort('valorAvaluoTitulo')" class="sortable">
            Valor del Avalúo
            <i class="fas fa-sort ms-1"></i>
          </th>
          <th scope="col" (click)="onSort('fechaAvaluo')" class="sortable">
            Fecha del Avalúo
            <i class="fas fa-sort ms-1"></i>
          </th>
          <th scope="col" (click)="onSort('porcentajeCubreGarantia')" class="sortable">
            Porcentaje que Cubre
            <i class="fas fa-sort ms-1"></i>
          </th>
          <th scope="col">Estado</th>
          <th scope="col">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of paginatedData">
          <td>{{ item.identificacionSujeto }}</td>
          <td>{{ item.numeroOperacion }}</td>
          <td>{{ item.numeroGarantia }}</td>
          <td>{{ item.tipoGarantia }}</td>
          <td>{{ item.descripcionGarantia }}</td>
          <td>
            <small>
              País: {{ item.ubicacionGarantiaPais }}<br>
              <span *ngIf="item.ubicacionGarantiaProvincia">Prov: {{ item.ubicacionGarantiaProvincia }}</span>
              <span *ngIf="item.ubicacionGarantiaCanton">Cantón: {{ item.ubicacionGarantiaCanton }}</span>
            </small>
          </td>
          <td>{{ formatCurrency(item.valorAvaluoTitulo) }}</td>
          <td>{{ formatDate(item.fechaAvaluo) }}</td>
          <td>{{ formatPercentage(item.porcentajeCubreGarantia) }}</td>
          <td>
            <span class="badge" 
                  [class.bg-success]="item.estadoRegistro === 'A'"
                  [class.bg-warning]="item.estadoRegistro === 'N'"
                  [class.bg-danger]="item.estadoRegistro === 'E'">
              {{ item.estadoRegistro }}
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="onEdit(item)" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button type="button" class="btn btn-sm btn-outline-danger" (click)="onDelete(item.id)" title="Eliminar">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- No Data Message -->
    <div *ngIf="paginatedData.length === 0" class="text-center py-4">
      <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        No se encontraron registros que coincidan con los criterios de búsqueda.
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && totalPages > 1" class="d-flex justify-content-between align-items-center mt-3">
    <div>
      Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} - 
      {{ Math.min(currentPage * itemsPerPage, filteredData.length) }} 
      de {{ filteredData.length }} registros
    </div>
    <nav>
      <ul class="pagination mb-0">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
        </li>
        
        <li *ngFor="let page of pageNumbers.slice(Math.max(0, currentPage - 3), Math.min(totalPages, currentPage + 2))" 
            class="page-item" 
            [class.active]="page === currentPage">
          <button class="page-link" (click)="onPageChange(page)">{{ page }}</button>
        </li>
        
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
            <i class="fas fa-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div>
