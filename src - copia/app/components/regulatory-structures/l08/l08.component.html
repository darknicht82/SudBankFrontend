<!-- COMPONENTE L08 - LIQUIDEZ ESTRUCTURAL -->
<!-- Manual de Riesgos de Mercado y Liquidez - Marzo 2021 -->
<!-- Superintendencia de Bancos de Panamá -->

<div class="l08-container">
  <!-- CABECERA -->
  <div class="header">
    <h1>L08 - Liquidez Estructural</h1>
    <p class="subtitle">Reporte de liquidez estructural según especificaciones oficiales SB</p>
  </div>

  <!-- FILTROS -->
  <div class="filters-section">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Filtros de Reporte</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="filters-grid">
          <mat-form-field>
            <mat-label>Fecha Inicio</mat-label>
            <input matInput type="date" [(ngModel)]="filters.fechaInicio">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Fecha Fin</mat-label>
            <input matInput type="date" [(ngModel)]="filters.fechaFin">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Tipo de Instrumento</mat-label>
            <mat-select [(ngModel)]="filters.tipoInstrumento">
              <mat-option value="">Todos</mat-option>
              <mat-option value="10">Bonos del Tesoro</mat-option>
              <mat-option value="20">Bonos Corporativos</mat-option>
              <mat-option value="30">Certificados de Depósito</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Calificación</mat-label>
            <mat-select [(ngModel)]="filters.calificacion">
              <mat-option value="">Todas</mat-option>
              <mat-option value="1">AAA</mat-option>
              <mat-option value="2">AA+</mat-option>
              <mat-option value="3">AA</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="filter-actions">
          <button mat-raised-button color="primary" (click)="applyFilters()" [disabled]="loading">
            <mat-icon>search</mat-icon>
            Aplicar Filtros
          </button>
          <button mat-button (click)="clearFilters()" [disabled]="loading">
            <mat-icon>clear</mat-icon>
            Limpiar
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- ACCIONES -->
  <div class="actions-section">
    <mat-card>
      <mat-card-content>
        <div class="actions-grid">
          <button mat-raised-button color="primary" (click)="generateReport()" [disabled]="loading">
            <mat-icon>refresh</mat-icon>
            Generar Reporte
          </button>
          <button mat-raised-button color="accent" (click)="exportReport()" [disabled]="!reportData || loading">
            <mat-icon>download</mat-icon>
            Exportar RVC
          </button>
          <button mat-raised-button color="warn" (click)="validateData()" [disabled]="!reportData || loading">
            <mat-icon>verified</mat-icon>
            Validar Datos
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- RESUMEN -->
  <div class="summary-section" *ngIf="reportData">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Resumen del Reporte</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="summary-grid">
          <div class="summary-item">
            <span class="label">Total Registros:</span>
            <span class="value">{{ reportData.totalRegistros }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Valor Total Lunes:</span>
            <span class="value">{{ formatCurrency(reportData.valorTotalLunes) }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Valor Total Viernes:</span>
            <span class="value">{{ formatCurrency(reportData.valorTotalViernes) }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Variación Semanal:</span>
            <span class="value" [class.positive]="getVariacionSemanal() > 0" [class.negative]="getVariacionSemanal() < 0">
              {{ getVariacionSemanal().toFixed(2) }}%
            </span>
          </div>
          <div class="summary-item">
            <span class="label">Cumplimiento:</span>
            <span class="value" [class.compliant]="reportData.cumplimiento >= 100">
              {{ getCumplimientoStatus() }}
            </span>
          </div>
          <div class="summary-item">
            <span class="label">Fecha Generación:</span>
            <span class="value">{{ reportData.fechaGeneracion | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- TABLA DE DATOS -->
  <div class="data-section" *ngIf="reportData">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Datos L08 - Liquidez Estructural</mat-card-title>
        <mat-card-subtitle>Según especificaciones oficiales Superintendencia de Bancos</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container">
          <table mat-table [dataSource]="reportData.estructura.detalles" class="l08-table">
            <!-- Código de Liquidez -->
            <ng-container matColumnDef="codigoLiquidez">
              <th mat-header-cell *matHeaderCellDef>Código Liquidez</th>
              <td mat-cell *matCellDef="let element">
                <div class="code-cell">
                  <span class="code">{{ element.codigoLiquidez }}</span>
                  <span class="description">{{ getDescripcion(element.codigoLiquidez, 'codigoLiquidez') }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Tipo Identificación -->
            <ng-container matColumnDef="tipoIdentificacion">
              <th mat-header-cell *matHeaderCellDef>Tipo ID</th>
              <td mat-cell *matCellDef="let element">
                <span class="badge" [class.ruc]="element.tipoIdentificacion === 'R'" [class.extranjero]="element.tipoIdentificacion === 'E'">
                  {{ element.tipoIdentificacion === 'R' ? 'RUC' : 'Extranjero' }}
                </span>
              </td>
            </ng-container>

            <!-- Identificación Entidad -->
            <ng-container matColumnDef="identificacionEntidad">
              <th mat-header-cell *matHeaderCellDef>Identificación</th>
              <td mat-cell *matCellDef="let element">{{ element.identificacionEntidad }}</td>
            </ng-container>

            <!-- Tipo Instrumento -->
            <ng-container matColumnDef="tipoInstrumento">
              <th mat-header-cell *matHeaderCellDef>Tipo Instrumento</th>
              <td mat-cell *matCellDef="let element">
                <div class="code-cell">
                  <span class="code">{{ element.tipoInstrumento }}</span>
                  <span class="description">{{ getDescripcion(element.tipoInstrumento, 'tipoInstrumento') }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Calificación Entidad -->
            <ng-container matColumnDef="calificacionEntidad">
              <th mat-header-cell *matHeaderCellDef>Calificación</th>
              <td mat-cell *matCellDef="let element">
                <div class="code-cell">
                  <span class="code">{{ element.calificacionEntidad }}</span>
                  <span class="description">{{ getDescripcion(element.calificacionEntidad, 'calificacionEntidad') }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Calificadora Riesgo -->
            <ng-container matColumnDef="calificadoraRiesgo">
              <th mat-header-cell *matHeaderCellDef>Calificadora</th>
              <td mat-cell *matCellDef="let element">
                <div class="code-cell">
                  <span class="code">{{ element.calificadoraRiesgo }}</span>
                  <span class="description">{{ getDescripcion(element.calificadoraRiesgo, 'calificadoraRiesgo') }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Valor Lunes -->
            <ng-container matColumnDef="valorLunes">
              <th mat-header-cell *matHeaderCellDef>Valor Lunes</th>
              <td mat-cell *matCellDef="let element">{{ formatCurrency(element.valorLunes) }}</td>
            </ng-container>

            <!-- Valor Martes -->
            <ng-container matColumnDef="valorMartes">
              <th mat-header-cell *matHeaderCellDef>Valor Martes</th>
              <td mat-cell *matCellDef="let element">{{ formatCurrency(element.valorMartes) }}</td>
            </ng-container>

            <!-- Valor Miércoles -->
            <ng-container matColumnDef="valorMiercoles">
              <th mat-header-cell *matHeaderCellDef>Valor Miércoles</th>
              <td mat-cell *matCellDef="let element">{{ formatCurrency(element.valorMiercoles) }}</td>
            </ng-container>

            <!-- Valor Jueves -->
            <ng-container matColumnDef="valorJueves">
              <th mat-header-cell *matHeaderCellDef>Valor Jueves</th>
              <td mat-cell *matCellDef="let element">{{ formatCurrency(element.valorJueves) }}</td>
            </ng-container>

            <!-- Valor Viernes -->
            <ng-container matColumnDef="valorViernes">
              <th mat-header-cell *matHeaderCellDef>Valor Viernes</th>
              <td mat-cell *matCellDef="let element">{{ formatCurrency(element.valorViernes) }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- ESTADO DE CARGA -->
  <div class="loading-section" *ngIf="loading">
    <mat-card>
      <mat-card-content>
        <div class="loading-content">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Cargando datos L08...</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- ERROR -->
  <div class="error-section" *ngIf="error">
    <mat-card>
      <mat-card-content>
        <div class="error-content">
          <mat-icon color="warn">error</mat-icon>
          <p>{{ error }}</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div> 